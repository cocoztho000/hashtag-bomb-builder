
<!doctype html>
<html>

<head>
    <title>Stacked Bar Chart</title>

    <style>
    canvas {
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }
    </style>
    <link rel="stylesheet" href="css/index.css">
    <script src="js/randomColor.js"></script>

</head>

<body>
    <div style="width: 75%">
        <canvas id="barChart"></canvas>
        <canvas id="myChart" width="500" height="300"></canvas>
    </div>
    <!-- <div id="js-legend" class="chart-legend"> -->

    <script>
        function getDataset() {
            return [{
                label: '#usa',
                backgroundColor: backgrounds[0],
                data: [
                    99,
                ]
            },{
                label: '#city',
                backgroundColor: backgrounds[1],
                data: [
                    36,
                ]
            },{
                label: '#run',
                backgroundColor: backgrounds[2],
                data: [
                    29,
                ]
            },{
                label: '#woo',
                backgroundColor: backgrounds[3],
                data: [
                    93,
                ]
            },{
                label: '#yum',
                backgroundColor: backgrounds[4],
                data: [
                    21,
                ]
            }];
        }

        function getDatasetPie() {
            var tempDataset = getDataset();
            var returnData = {
                "labels": [],
                "datasets": [{
                    "backgroundColor": [],
                    "data": [],
                }]
            };

            tempDataset.forEach(function(tempData){
                returnData["labels"].push(tempData["label"]);
                returnData["datasets"][0]["backgroundColor"].push(tempData["backgroundColor"]);
                returnData["datasets"][0]["data"].push(tempData["data"]);
            });
            return returnData;
        }

        var backgrounds = randomColor({count: 5, luminosity: 'light'});
        var barChartData = {
            labels: ['#party'],
            datasets: getDataset(),
        };

        var allSiteCharts = []

        window.onload = function() {

            // Override the click handler
            var ctx                       = document.getElementById('barChart').getContext('2d');
            var defaultLegendClickHandler = Chart.defaults.global.legend.onClick;


            window.myBar = new Chart(ctx, {
                type: 'bar',
                data: barChartData,
                options: {
                    title: {
                        display: true,
                        text: 'Chart.js Bar Chart - Stacked'
                    },
                    tooltips: {
                        mode: 'index',
                        intersect: true
                    },
                    responsive: true,
                    scales: {
                        yAxes: [{
                            stacked: true
                        }]
                    },
                    legend: {
                        display: true,
                        onClick: newLegendClickHandler,
                   },
                }
            });

            var ctx = document.getElementById("myChart").getContext('2d');
            var pieCharData = getDatasetPie();
            window.myChart = new Chart(ctx, {
              type: 'pie',
              options:{
                legend:{
                  display:false
                }
              },
              data: {
                labels: pieCharData["labels"],
                datasets: pieCharData["datasets"],
              }
            });

            console.log(window.myChart)
            console.log(window.myBar)
            // Allow For chart to be modified
            allSiteCharts.push(window.myBar);
            allSiteCharts.push(window.myChart);
            // document.getElementById('js-legend').innerHTML = window.myBar.generateLegend();
        };

        function getCharts() {
            return allSiteCharts
        }

        function newLegendClickHandler (e, legendItem) {
            var index = legendItem.datasetIndex;
            var hideData = !legendItem.hidden;

            // Loop through all charts and upate them when legend is clicked
            getCharts().forEach(function(siteChart) {
                if (siteChart != null){
                    if (siteChart.config.type === "bar"){
                        siteChart.data.datasets[index].hidden = hideData;
                    }
                    if (siteChart.config.type === "pie"){
                        siteChart.getDatasetMeta(0).data[index].hidden = hideData;
                    }
                    siteChart.update();
                }
            });
        }

    </script>
</body>
<script src="js/chart.bundle.min.js"></script>
<script src="js/Chart.min.js"></script>
<script src="js/index.js"></script>

</html>
